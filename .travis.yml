language: java
sudo: required
os: linux
dist: trusty

branches:
  only:
    - master

jdk:
  - oraclejdk8

services:
  - docker

script:
  - mvn site
  - mvn cobertura:cobertura

after_success:
  - chmod +x push.sh
  - chmod +x pushdoc.sh
  - ./pushdoc.sh
  - ./push.sh # merged on release branch
  - bash <(curl -s https://codecov.io/bash) -t $CODECOV_TOKEN


before_deploy:
  - docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"
  - dockerbuild/update.sh

deploy:
  provider: script
  script: bash docker_push.sh
  on:
    branch: master